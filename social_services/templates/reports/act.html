{% extends 'base.html' %}

{% block title %}–ê–∫—Ç –æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥ - {{ recipient.full_name }}{% endblock %}

{% block extra_css %}
<style>
    @media print {
        body { background: white; }
        nav, footer, .no-print { display: none !important; }
        .print-only { display: block !important; }
    }
    
    .act-container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .act-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .act-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 20px;
    }
    
    .act-info {
        margin-bottom: 20px;
        line-height: 1.8;
    }
    
    .act-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 30px;
    }
    
    .act-table th, .act-table td {
        border: 1px solid #000;
        padding: 8px 12px;
        text-align: left;
    }
    
    .act-table th {
        background-color: #f0f0f0;
        font-weight: bold;
        text-align: center;
    }
    
    .act-table .number {
        width: 50px;
        text-align: center;
    }
    
    .act-table .quantity, .act-table .price, .act-table .total {
        width: 80px;
        text-align: right;
    }
    
    .act-total {
        font-size: 16px;
        font-weight: bold;
        text-align: right;
        margin-bottom: 30px;
    }
    
    .act-signatures {
        margin-top: 50px;
    }
    
    .signature-line {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
    }
    
    .signature-field {
        width: 45%;
    }
    
    .signature-field .line {
        border-bottom: 1px solid #000;
        height: 30px;
        margin-bottom: 5px;
    }
    
    .signature-field .label {
        font-size: 12px;
        color: #666;
    }
</style>
{% endblock %}

{% block content %}
<div class="no-print mb-4">
    <a href="{% url 'reports:export_act_pdf' recipient.id year month %}" 
       class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg inline-flex items-center gap-2">
        üì• –°–∫–∞—á–∞—Ç—å PDF
    </a>
    <button onclick="window.print()" 
            class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg inline-flex items-center gap-2 ml-2">
        üñ®Ô∏è –ü–µ—á–∞—Ç—å
    </button>
    <a href="{% url 'reports:act_generator' %}" 
       class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg inline-flex items-center gap-2 ml-2">
        ‚Üê –ù–∞–∑–∞–¥
    </a>
</div>

<div class="act-container">
    <div class="act-header">
        <div class="act-title">–ê–ö–¢</div>
        <div>–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥</div>
        <div>–∑–∞ {{ month_name }} {{ year }} –≥–æ–¥–∞</div>
    </div>
    
    <div class="act-info">
        <p><strong>–ü–æ–ª—É—á–∞—Ç–µ–ª—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥:</strong> {{ recipient.full_name }}</p>
        <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ recipient.birth_date|date:"d.m.Y" }}</p>
        <p><strong>–û—Ç–¥–µ–ª–µ–Ω–∏–µ:</strong> {{ recipient.department.name }}</p>
        <p><strong>–ö–æ–º–Ω–∞—Ç–∞:</strong> {{ recipient.room|default:"--" }}</p>
        <p><strong>–ü–µ—Ä–∏–æ–¥:</strong> {{ month_name }} {{ year }} –≥–æ–¥–∞ (—Å 01.{{ month|stringformat:"02d" }}.{{ year }} –ø–æ {{ days_in_month }}.{{ month|stringformat:"02d" }}.{{ year }})</p>
    </div>
    
    <table class="act-table">
        <thead>
            <tr>
                <th class="number">‚Ññ –ø/–ø</th>
                <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏</th>
                <th class="quantity">–ö–æ–ª-–≤–æ</th>
                <th class="price">–¶–µ–Ω–∞, —Ä—É–±.</th>
                <th class="total">–°—É–º–º–∞, —Ä—É–±.</th>
            </tr>
        </thead>
        <tbody>
            {% for item in services_data %}
            <tr>
                <td class="number">{{ forloop.counter }}</td>
                <td>{{ item.service.code }}. {{ item.service.name }}</td>
                <td class="quantity">{{ item.quantity }}</td>
                <td class="price">{{ item.price|floatformat:2 }}</td>
                <td class="total">{{ item.total|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center py-4">–ù–µ—Ç –æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4" style="text-align: right; font-weight: bold;">–ò—Ç–æ–≥–æ</td>
                <td class="total" style="font-weight: bold;">{{ total_sum|floatformat:2 }} —Ä—É–±.</td>
            </tr>
        </tfoot>
    </table>
    
    <div class="act-total">
        –í—Å–µ–≥–æ –æ–∫–∞–∑–∞–Ω–æ —É—Å–ª—É–≥: {{ services_data|length }} –Ω–∞ —Å—É–º–º—É: {{ total_sum|floatformat:2 }} —Ä—É–±.
    </div>
    
    <div class="act-signatures">
        <div class="signature-line">
            <div class="signature-field">
                <div class="line"></div>
                <div class="label">–î–∏—Ä–µ–∫—Ç–æ—Ä —É—á—Ä–µ–∂–¥–µ–Ω–∏—è</div>
            </div>
            <div class="signature-field">
                <div class="line"></div>
                <div class="label">–ü–æ–¥–ø–∏—Å—å</div>
            </div>
        </div>
        
        <div class="signature-line">
            <div class="signature-field">
                <div class="line"></div>
                <div class="label">–ì–ª–∞–≤–Ω—ã–π –±—É—Ö–≥–∞–ª—Ç–µ—Ä</div>
            </div>
            <div class="signature-field">
                <div class="line"></div>
                <div class="label">–ü–æ–¥–ø–∏—Å—å</div>
            </div>
        </div>
        
        <div class="signature-line">
            <div class="signature-field">
                <div class="line"></div>
                <div class="label">–ó–∞–≤–µ–¥—É—é—â–∏–π –æ—Ç–¥–µ–ª–µ–Ω–∏–µ–º</div>
            </div>
            <div class="signature-field">
                <div class="line"></div>
                <div class="label">–ü–æ–¥–ø–∏—Å—å</div>
            </div>
        </div>
    </div>
    
    <div class="mt-8 text-sm text-gray-500">
        –ê–∫—Ç —Å–æ—Å—Ç–∞–≤–ª–µ–Ω: {{ today|date:"d.m.Y" }}
    </div>
</div>
{% endblock %}
