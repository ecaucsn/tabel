<!DOCTYPE html>
<html lang="ru">
{% load service_tags %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–∫—Ç –æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥ - {{ recipient.full_name }}</title>
    <style>
        @page {
            size: A4 portrait;
            margin: 10mm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 10pt;
            line-height: 1.2;
            color: #000;
            background: #fff;
        }
        
        .act-container {
            width: 190mm;
            margin: 0 auto;
        }
        
        /* Header */
        .act-header {
            text-align: center;
            margin-bottom: 5mm;
        }
        
        .act-title {
            font-size: 11pt;
            font-weight: bold;
        }
        
        .act-period {
            font-size: 11pt;
            font-weight: bold;
        }
        
        /* Info sections */
        .act-info {
            margin-bottom: 3mm;
            text-align: justify;
        }
        
        .act-info-label {
            font-weight: bold;
        }
        
        .act-note {
            margin-bottom: 3mm;
            font-size: 9pt;
        }
        
        /* Table */
        .act-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 3mm;
            font-size: 9pt;
        }
        
        .act-table th,
        .act-table td {
            border: 0.5pt solid windowtext;
            padding: 1mm 2mm;
            vertical-align: middle;
        }
        
        .act-table th {
            text-align: center;
            font-weight: normal;
        }
        
        .col-num {
            width: 12mm;
            text-align: center;
        }
        
        .col-name {
            text-align: left;
        }
        
        .col-price {
            width: 22mm;
            text-align: right;
        }
        
        .col-qty {
            width: 15mm;
            text-align: center;
        }
        
        .col-sum {
            width: 22mm;
            text-align: right;
        }
        
        /* Category row */
        .category-row td {
            font-weight: bold;
            border-top: 0.5pt solid windowtext;
            border-bottom: 0.5pt solid windowtext;
        }
        
        /* Subtotal row */
        .subtotal-row td {
            font-weight: bold;
        }
        
        /* Total row */
        .total-row td {
            font-weight: bold;
            font-size: 10pt;
            border-top: 0.5pt solid windowtext;
        }
        
        /* Summary section */
        .summary-section {
            margin-top: 4mm;
            margin-bottom: 4mm;
            font-size: 10pt;
        }
        
        .summary-row {
            margin-bottom: 2mm;
        }
        
        .summary-label {
            display: inline-block;
            width: 100mm;
        }
        
        .summary-value {
            display: inline-block;
            width: 30mm;
            text-align: right;
            font-weight: bold;
        }
        
        .summary-unit {
            display: inline-block;
            width: 10mm;
        }
        
        /* Note about 75% */
        .note-75 {
            margin: 3mm 0;
            font-size: 9pt;
            text-align: justify;
        }
        
        /* Signatures */
        .signatures {
            margin-top: 10mm;
        }
        
        .signature-block {
            margin-bottom: 5mm;
            font-size: 10pt;
        }
        
        .signature-title {
            font-size: 9pt;
            color: #666;
        }
        
        /* Print button - hidden when printing */
        .print-button {
            position: fixed;
            top: 10mm;
            right: 10mm;
            padding: 3mm 6mm;
            background: #0ea5e9;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11pt;
            z-index: 1000;
        }
        
        .print-button:hover {
            background: #0284c7;
        }
        
        @media print {
            .print-button {
                display: none !important;
            }
            
            body {
                font-size: 9pt;
            }
            
            .act-container {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">üñ® –ü–µ—á–∞—Ç—å</button>
    
    <div class="act-container">
        <!-- Header -->
        <div class="act-header">
            <div class="act-title">–ê–∫—Ç –æ–± –æ–∫–∞–∑–∞–Ω–∏–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥</div>
            <div class="act-period">–∑–∞ {{ month_name }} {{ year }} –≥.</div>
        </div>
        
        <!-- –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å -->
        <div class="act-info">
            <span class="act-info-label">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</span>
            <span> –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≥—Ä–∞–∂–¥–∞–Ω –ø–æ–∂–∏–ª–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ –∏–Ω–≤–∞–ª–∏–¥–æ–≤ —Å–∏—Å—Ç–µ–º—ã —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã –Ω–∞—Å–µ–ª–µ–Ω–∏—è –ü–µ–Ω–∑–µ–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ "–°–æ—Å–Ω–æ–≤—Å–∫–∏–π –¥–æ–º —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è" –≤ –ª–∏—Ü–µ –∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ø–æ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ –ë–æ–Ω–¥–∞—Ä–µ–Ω–∫–æ –ö–∏—Ä–∏–ª–ª–∞ –ü–µ—Ç—Ä–æ–≤–∏—á–∞
		</div>
        
        <!-- –ó–∞–∫–∞–∑—á–∏–∫ -->
        <div class="act-info">
            <span class="act-info-label">–ó–∞–∫–∞–∑—á–∏–∫:</span>
            <span>  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã –Ω–∞—Å–µ–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ë–µ—Å–æ–Ω–æ–≤—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞ –≤ –ª–∏—Ü–µ –∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—è –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –°–æ–∫–æ–ª–æ–≤–∞ –°–µ—Ä–≥–µ—è –ê–Ω–∞—Ç–æ–ª—å–µ–≤–∏—á–∞, –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –≤ –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö –Ω–µ–¥–µ–µ—Å–ø–æ—Å–æ–±–Ω–æ–≥–æ {{ recipient.full_name }} {{ recipient.birth_date|date:"d.m.Y" }}–≥.</span>
        </div>
        
        <div class="act-note">
            –ò—Å–ø–æ–Ω–∏—Ç–µ–ª—å –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤—ã–ø–æ–ª–Ω–∏–ª –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–æ –æ–∫–∞–∑–∞–Ω–∏—é —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥:
        </div>
        
        <!-- Services Table -->
        <table class="act-table">
            <thead>
                <tr>
                    <th class="col-num">‚Ññ</th>
                    <th class="col-name">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —É—Å–ª—É–≥–∏</th>
                    <th class="col-price">–¶–µ–Ω–∞, —Ä—É–±.</th>
                    <th class="col-qty">–ö–æ–ª-–≤–æ</th>
                    <th class="col-sum">–°—É–º–º–∞, —Ä—É–±.</th>
                </tr>
            </thead>
            <tbody>
                {% for cat_item in categories_with_services %}
                    <tr class="category-row">
                        <td colspan="5">{{ cat_item.category.name }}:</td>
                    </tr>
                    {% for item in cat_item.services %}
                    <tr>
                        <td class="col-num">{{ item.row_number }}</td>
                        <td class="col-name">{{ item.service.name }}</td>
                        <td class="col-price">{{ item.price|floatformat:2 }}</td>
                        <td class="col-qty">{% if item.quantity > 0 %}{{ item.quantity }}{% endif %}</td>
                        <td class="col-sum">{{ item.total|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                    <tr class="subtotal-row">
                        <td colspan="4" style="text-align: right; padding-right: 3mm;">–ò—Ç–æ–≥–æ:</td>
                        <td class="col-sum">{{ cat_item.services|category_total }}</td>
                    </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; padding: 5mm;">–ù–µ—Ç —É—Å–ª—É–≥ –≤ –ò–ü–ü–°–£</td>
                </tr>
                {% endfor %}
                
                <tr class="total-row">
                    <td colspan="4" style="text-align: right; padding-right: 3mm;">
                        –í—Å–µ–≥–æ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥ –∑–∞ –º–µ—Å—è—Ü:
                    </td>
                    <td class="col-sum">{{ total_sum|floatformat:2 }}</td>
                </tr>
            </tbody>
        </table>
        
        <!-- Note about 75% -->
        <div class="note-75">
           –†–∞–∑–º–µ—Ä –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π –ø–ª–∞—Ç—ã –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥,–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π, –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 75% —Å—Ä–µ–¥–Ω–µ–¥—É—à–µ–≤–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞, –ø—Ä–∏–∑–Ω–∞–Ω–Ω–æ–≥–æ –Ω—É–∂–¥–∞—é—â–∏–º—Å—è –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥–∞—Ö, —Ä–∞—Å—á–∏—Ç–∞–Ω–Ω–æ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–§.
        </div>
        
        <!-- Summary -->
        <div class="summary-section">
            <div class="summary-row">
                <span class="summary-label">–†–∞–∑–º–µ—Ä  —Å—Ä–µ–¥–Ω–µ–¥—É—à–µ–≤–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥:</span>
                <span class="summary-value">{{ income|floatformat:2 }}</span>
                <span class="summary-unit">—Ä—É–±.</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 75% –æ—Ç —Å—Ä–µ–¥–Ω–µ–¥—É—à–µ–≤–æ–≥–æ –¥–æ—Ö–æ–¥–∞:</span>
                <span class="summary-value">{{ limit_75|floatformat:2 }}</span>
                <span class="summary-unit">—Ä—É–±.</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">–§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–æ –ü–µ–Ω—Å–∏–æ–Ω–Ω—ã–º —Ñ–æ–Ω–¥–æ–º –≤ –î–°–û:</span>
                <span class="summary-value">{{ pension_payment|floatformat:2 }}</span>
                <span class="summary-unit">—Ä—É–±.</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ –∑–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏:</span>
                <span class="summary-value">{{ total_sum|floatformat:2 }}</span>
                <span class="summary-unit">—Ä—É–±.</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">–ü–µ—Ä–µ–ø–ª–∞—Ç–∞/–Ω–µ–¥–æ–ø–ª–∞—Ç–∞ –∑–∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏:</span>
                <span class="summary-value">{{ difference|floatformat:2 }}</span>
                <span class="summary-unit">—Ä—É–±.</span>
            </div>
        </div>
        
        <!-- Signatures -->
        <div class="signatures">
            <div class="signature-block">
                –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å ___________________________ –ö.–ü. –ë–æ–Ω–¥–∞—Ä–µ–Ω–∫–æ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  –ó–∞–∫–∞–∑—á–∏–∫ ___________________________ –°.–ê. –°–æ–∫–æ–ª–æ–≤<br>
            </div>
            
        </div>
    </div>
    
    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—á–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            window.print();
        }
    </script>
</body>
</html>
